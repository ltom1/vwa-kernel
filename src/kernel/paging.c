///////////////////////////////////////////////////////////////////////////////////////////////////
/// @file
/// @brief  Converting between page numbers and addresses.
///
/// Contains functions for calculating the base page address or the page number from an address.
///////////////////////////////////////////////////////////////////////////////////////////////////

#include <types.h>
#include <paging.h>


/// @brief  The base address of the physical-to-virtual mapping.
///
/// Set by the virtual memory manager. Identity mapped by the bootloader -> 0.
u64 pv_base = 0;


///////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief  Returns the page number of an address by rounding up.
///
/// @param  addr    The address.
///////////////////////////////////////////////////////////////////////////////////////////////////

u64 page_round_up(u64 addr) {

    u64 num = addr / PAGE_SIZE;
    if (addr % PAGE_SIZE != 0) num++;
    return num;
}


///////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief  Returns the page number of an address by rounding down.
///
/// @param  addr    The address.
///////////////////////////////////////////////////////////////////////////////////////////////////

u64 page_round_down(u64 addr) {

    return addr / PAGE_SIZE;
}


///////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief  Returns the base page address (multiple of PAGE_SIZE) of an address.
///
/// @param  addr    The address
///
/// Flattens the address and clears the last few bits.
///////////////////////////////////////////////////////////////////////////////////////////////////

u64 page_base(u64 addr) {

    return addr & ~0xFFF;
}
